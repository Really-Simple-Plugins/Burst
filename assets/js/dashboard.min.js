jQuery(document).ready(function(a){function l(){a(".burst-experiment-start button").removeAttr("disabled");a(".burst-experiment-stop button").removeAttr("disabled");a(".burst_selected_experiment_id_wrapper select").removeAttr("disabled")}function m(){a(".burst-experiment-start button").attr("disabled",!0);a(".burst-experiment-stop button").attr("disabled",!0);a(".burst_selected_experiment_id_wrapper select").attr("disabled",!0)}function k(c,b){var g="undefined"===typeof c;c="undefined"!==typeof c?
c:parseInt(a("input[name=burst_experiment_start]").val());b="undefined"!==typeof b?b:parseInt(a("input[name=burst_experiment_end]").val());m();window.config={type:"line",data:{labels:"... ... ... ... ... ... ...".split(" "),datasets:[{label:"...",backgroundColor:"rgb(41, 182, 246)",borderColor:"rgb(41, 182, 246)",data:[0,0,0,0,0,0,0],fill:!1},{label:"...",backgroundColor:"rgb(244, 191, 62)",borderColor:"rgb(244, 191, 62)",data:[0,0,0,0,0,0,0],fill:!1}]},options:{legend:{display:!0},responsive:!0,
maintainAspectRatio:!1,title:{display:!1,text:"Select an experiment"},tooltips:{enabled:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!1,scaleLabel:{display:!0,labelString:"Date"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Count"},ticks:{beginAtZero:!0,min:0,max:10,stepSize:5}}]}}};var e=document.getElementsByClassName("burst-chartjs-stats");void 0!=window.conversionGraph&&window.conversionGraph.destroy();window.conversionGraph=new Chart(e,window.config);e=a("select[name=burst_selected_experiment_id]").val();
0<e&&a.ajax({type:"get",dataType:"json",url:burst.ajaxurl,data:{action:"burst_get_experiment_statistics",experiment_id:e,date_start:c,date_end:b},success:function(d){if(1==d.success){g&&(a("input[name=burst_experiment_start]").val(d.data.date_start),a("input[name=burst_experiment_end]").val(d.data.date_end),n(moment.unix(d.data.date_start),moment.unix(d.data.date_end)));var h=0;d.data.datasets.forEach(function(f){window.config.data.datasets.hasOwnProperty(h)?window.config.data.datasets[h]=f:window.config.data.datasets.push(f);
h++});window.config.data.labels=d.data.labels;window.config.options.title.text=d.title;window.config.options.scales.yAxes[0].ticks.max=parseInt(d.data.max);window.conversionGraph.update();l()}else alert("Your experiment data could not be loaded")}})}function p(){var c=a("select[name=burst_selected_experiment_id]").val(),b=parseInt(a("input[name=burst_experiment_start]").val()),g=parseInt(a("input[name=burst_experiment_end]").val());a(".burst-load-ajax").each(function(){var e=a(this);0==e.find(".burst-skeleton").length&&
e.find(".burst-grid-content").fadeOut(200,function(){a(this).html('<div class="burst-skeleton"></div>').fadeIn(300)});var d=e.data("table_type");a.ajax({type:"get",dataType:"json",url:burst.ajaxurl,data:{action:"burst_load_grid_block",experiment_id:c,date_start:b,date_end:g,type:d},success:function(h){h.success&&e.find(".burst-grid-content").fadeOut(300,function(){a(this).html(h.html).fadeIn(200)})}})})}function n(c,b){a(".burst-date-container span").html(c.format("MMMM D, YYYY")+" - "+b.format("MMMM D, YYYY"))}
function q(){var c=a("select[name=burst_selected_experiment_id]").val();0==a(".burst-experiment-status").find(".loading").length&&(a(".burst-experiment-status .burst-bullet").removeClass().addClass("burst-bullet grey loading"),a(".burst-experiment-status .burst-experiment-status__text").fadeOut(300,function(){a(this).html("Loading...").fadeIn(200)}),a(".burst-experiment-stop").fadeOut(),a(".burst-experiment-completed").fadeOut(200));a.ajax({type:"get",dataType:"json",url:burst.ajaxurl,data:{action:"burst_load_status_info",
experiment_id:c},success:function(b){b.success&&(a(".burst-experiment-status .burst-bullet").removeClass().addClass("burst-bullet "+b.data.status["class"]),a(".burst-experiment-status .burst-experiment-status__text").fadeOut(300,function(){a(this).html(b.data.status.title).fadeIn(200)}),a(".burst-experiment-stop").hide(),a(".burst-experiment-completed").hide(),"Active"===b.data.status.title?a(".burst-experiment-stop").show():"Completed"===b.data.status.title&&(a(".burst-experiment-completed-text").html(b.data.date_end_text),
a(".burst-experiment-completed").show()))}})}a(document).on("click",".burst-dismiss-notice",function(){var c=a(this).data("notice_id"),b=a(this);b.attr("disabled","disabled");a.ajax({type:"POST",url:burst.ajaxurl,dataType:"json",data:{action:"burst_dismiss_notice",id:c},success:function(g){b.removeAttr("disabled");g.success&&b.closest(".burst-notice").remove()}})});a(document).on("click",".burst-statistics-action",function(){var c=a(this).data("experiment_action"),b=a("select[name=burst_selected_experiment_id]").val();
m();a.ajax({type:"POST",url:burst.ajaxurl,dataType:"json",data:{action:"burst_experiment_action",type:c,experiment_id:b,token:burst.token},success:function(g){g.success&&(l(),a(".burst-experiment-start").hide(),a(".burst-experiment-stop").hide(),"start"===c?a(".burst-experiment-stop").show():a(".burst-experiment-start").show())}})});(function(){var c=burstLocalizeString("Today"),b=burstLocalizeString("Yesterday"),g=burstLocalizeString("Last 7 days"),e=burstLocalizeString("Last 30 days"),d=burstLocalizeString("This Month"),
h=burstLocalizeString("Last Month"),f={};f[c]=[v,w];f[b]=[x,r];f[g]=[y,z];f[e]=[moment().subtract(31,"days"),r];f[d]=[moment().startOf("month"),moment().endOf("month")];f[h]=[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")];c=parseInt(a("input[name=burst_experiment_start]").val());b=parseInt(a("input[name=burst_experiment_end]").val());if(null===c||null===b)c=moment().endOf("day").subtract(1,"week").unix(),b=moment().endOf("day").unix();c=parseInt(c);b=parseInt(b);
k();var v=moment().endOf("day").subtract(1,"days").add(1,"minutes"),w=moment().endOf("day"),x=moment().endOf("day").subtract(2,"days").add(1,"minutes"),r=moment().endOf("day").subtract(1,"days"),y=moment().endOf("day").subtract(8,"days").add(1,"minutes"),z=moment().endOf("day").subtract(1,"days");a(".burst-date-container.burst-date-range").daterangepicker({ranges:f,locale:{format:burstLocalizeString("date_format","burst"),separator:" - ",applyLabel:burstLocalizeString("Apply","burst"),cancelLabel:burstLocalizeString("Cancel",
"burst"),fromLabel:burstLocalizeString("From","burst"),toLabel:burstLocalizeString("To","burst"),customRangeLabel:burstLocalizeString("Custom","burst"),weekLabel:burstLocalizeString("W","burst"),daysOfWeek:[burstLocalizeString("Mo","burst"),burstLocalizeString("Tu","burst"),burstLocalizeString("We","burst"),burstLocalizeString("Th","burst"),burstLocalizeString("Fr","burst"),burstLocalizeString("Sa","burst"),burstLocalizeString("Su","burst")],monthNames:[burstLocalizeString("January"),burstLocalizeString("February"),
burstLocalizeString("March"),burstLocalizeString("April"),burstLocalizeString("May"),burstLocalizeString("June"),burstLocalizeString("July"),burstLocalizeString("August"),burstLocalizeString("September"),burstLocalizeString("October"),burstLocalizeString("November"),burstLocalizeString("December")],firstDay:1},alwaysShowCalendars:!0,startDate:moment.unix(c),endDate:moment.unix(b),opens:"left"},function(t,u,A){n(t,u);k(t.unix(),u.unix())})})();a(document).on("change","select[name=burst_selected_experiment_id]",
function(){k();p();q()});p();q()});